{% extends "base.html" %}
{% block content %}

<div class="row">
    <div class="col-lg-12 text-center">
        <h1>Listar dispositivos</h1>
    </div>
    <div class="offset-lg-2 col-lg-8" style="margin-top:20px">
    <form class="row g-3">
      <div class="col-12">
        <label for="topic" class="form-label">Topic</label>
        <input type="text" class="form-control" id="topic" name="topic" placeholder="Escribe # para escuchar todos">
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-primary" id="comenzar">Comenzar</button>
      </div>
    </form>
        <div id="spinner" class="mt-5 d-none">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        <div id="respuesta"></div>
</div>
</div>
<br/>
{% endblock content %}

{% block javascript%}
    $("#comenzar").on("click",function(){
        controlSpinner()
        $(this).prop("disabled",true);
	    		var fd = new FormData();
		        var topic = $("#topic").val();
		        fd.append('topic',topic);
		        $.ajax({
		            url: '/escucharTopic',
		            type: 'post',
		            contentType: false,
                    data: fd,
		            processData: false,
		            success: function(response){
		                if(response != 0){
		                	var obj = JSON.parse(response)
                            console.log(obj)
		                }else{
		                	var html = "No se ha encontrado ningun dispositivo";
                            inyectarRespuesta(html);
		                }
		            },
		        });
	    	})
    function inyectarRespuesta(texto){
        $("#respuesta").append(texto)
    }
    function controlSpinner(){
        $("#spinner").toggleClass("d-none")
    }
{% endblock javascript%}